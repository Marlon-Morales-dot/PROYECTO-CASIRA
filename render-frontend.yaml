# ============================================
# RENDER CONFIG - SERVICIO NODE.JS/REACT FRONTEND
# ============================================
# Para: proyecto-casira-1.onrender.com (Frontend Static Site)

services:
  - type: web
    name: casira-connect-frontend
    runtime: node
    rootDir: .
    buildCommand: |
      echo "ğŸ”¨ Building CASIRA Connect with Node.js server..."
      echo "ğŸ“¦ Installing root dependencies..."
      npm install --no-fund --no-audit
      echo "ğŸ—ï¸ Building frontend..."
      cd apps/web
      echo "ğŸ“¦ Installing frontend dependencies..."
      npm ci --include=dev --no-fund --no-audit
      echo "ğŸ”¨ Running build..."
      npm run build
      echo "ğŸ“ Checking build output..."
      ls -la dist/
      echo "âœ… Build completed - checking dist folder exists..."
      if [ ! -f "dist/index.html" ]; then
        echo "âŒ Build failed - index.html not found"
        exit 1
      fi
      cd ../..
      echo "âœ… Build verification passed"
    startCommand: |
      echo "ğŸš€ Starting Express server with Google Auth support..."
      echo "ğŸ“ Current directory: $(pwd)"
      echo "ğŸ“ Contents: $(ls -la)"
      cd apps/web
      echo "ğŸ“ Changed to: $(pwd)"
      echo "ğŸ“ Web contents: $(ls -la)"
      echo "ğŸ”§ Checking if server.js exists..."
      if [ -f "server.js" ]; then
        echo "âœ… server.js found"
      else
        echo "âŒ server.js NOT found"
      fi
      echo "ğŸš€ Starting server with npm start..."
      npm start
    plan: free
    envVars:
      - key: NODE_VERSION
        value: 20.18.0
      - key: NODE_ENV
        value: production